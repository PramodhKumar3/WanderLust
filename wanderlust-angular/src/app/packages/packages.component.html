<div *ngIf="!bookingPage" id="details" class="details-section">
    <div class="page-header">
        <h1 *ngIf="!isUserLoggedIn" class="page-title">
            Discover <span class="highlight">{{searchTerm ? (searchTerm | titlecase) : (continent | titlecase)}}</span>
            <small>Your dream vacation is just a click away</small>
        </h1>
        <div *ngIf="isUserLoggedIn" class="page-title">
            <h1>Explore Dream Destinations</h1>
            <p>Enjoy your perfect trip with us!</p>
        </div>
    </div>

<!-- filter bar -->
    <div class="container filter-container">
        <div class="filter-bar">
            <div class="row">

                <div class="col-md-3">
                    <div class="filter-item">
                        <div class="filter-label">
                            <span>Min Price</span>
                            <span class="filter-value">${{minPrice}}</span>
                        </div>
                        <input type="range" class="slider" min="0" max="10000" step="100" [value]="minPrice"
                            (input)="updateMinPrice($event)">
                        <div class="range-markers">
                            <span>$0</span>
                            <span class="flex-grow-1"></span>
                            <span>$10,000</span>
                        </div>
                    </div>
                </div>


                <div class="col-md-3">
                    <div class="filter-item">
                        <div class="filter-label">
                            <span>Max Price</span>
                            <span class="filter-value">${{maxPrice}}</span>
                        </div>
                        <input type="range" class="slider" min="0" max="10000" step="100" [value]="maxPrice"
                            (input)="updateMaxPrice($event)">
                        <div class="range-markers">
                            <span>$0</span>
                            <span class="flex-grow-1"></span>
                            <span>$10,000</span>
                        </div>
                    </div>
                </div>


                <div class="col-md-3">
                    <div class="filter-item">
                        <div class="filter-label">
                            <span>Max Nights</span>
                            <span class="filter-value">{{noOfDays}}</span>
                        </div>
                        <input type="range" class="slider" min="0" max="15" step="1" [value]="noOfDays"
                            (input)="updateDays($event)">
                        <div class="range-markers">
                            <span>0</span>
                            <span class="flex-grow-1"></span>
                            <span>15</span>
                        </div>
                    </div>
                </div>


                <div class="col-md-3">
                    <div class="filter-item">
                        <div class="filter-label">
                            <span>Customer Rating</span>
                        </div>
                        <select class="form-control" [(ngModel)]="customerRating" (change)="showValue()">
                            <option value="" disabled selected>Select Rating</option>
                            <option value="3">3+ ‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</option>
                            <option value="3.5">3.5+ ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</option>
                            <option value="4">4+ ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</option>
                            <option value="4.5">4.5+ ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="results-summary">
            <span *ngIf="newList && newList.length > 0">
                Found {{newList.length}} packages
                <span *ngIf="searchTerm"> for "{{searchTerm}}"</span>
            </span>
            <span class="error-message" *ngIf="errorMessage">{{errorMessage}}</span>
        </div>
    </div>


    <div class="container" *ngIf="!showItenary">
        <div class="no-results" *ngIf="newList && newList.length === 0 && !errorMessage">
            <div class="icon">üîç</div>
            <h3>No packages found</h3>
            <p>Try adjusting your filters or search for a different destination</p>
        </div>

        <div class="package-list">
            <div *ngFor="let package of newList" class="package-card">
                <div class="card-content">
                    <div class="image-section">
                        <img class="package-image" [src]="package.imageUrl" alt="{{package.destinationName}}">
                        <div class="nights-badge">{{package.noOfNights}} Nights</div>
                        <div class="discount-badge" *ngIf="package.discount > 0">{{package.discount}}% OFF</div>
                    </div>
                    <div class="card-details-section" [class.expanded]="expandedDescriptions[package.destinationId]">
                        <h3 class="package-title">{{package.destinationName}}</h3>

                        <div class="package-description" [class.expanded]="expandedDescriptions[package.destinationId]">
                            <div *ngIf="!expandedDescriptions[package.destinationId]; else fullDescription">
                                {{(package.details?.about || '').substring(0, 100)}}{{(package.details?.about ||
                                '').length > 100 ? '...' : ''}}
                                <span *ngIf="(package.details?.about || '').length > 100" class="read-more-link"
                                    (click)="toggleDescription(package.destinationId, $event)">
                                    Read more
                                </span>
                            </div>

                            <ng-template #fullDescription>
                                {{package.details?.about || ''}}
                                <span class="read-more-link" (click)="toggleDescription(package.destinationId, $event)">
                                    Show less
                                </span>
                            </ng-template>
                        </div>

                        <div class="price-section">
                            <div class="price">
                                <span class="label">Price per person:</span>
                                <span class="amount">{{package.chargePerPerson | currency}}</span>
                            </div>
                        </div>
                    </div>

                    <div class="action-section">
                        <button class="btn-details" (click)="getitenary(package.destinationId)">
                            View Details
                        </button>
                        <button class="btn-book" [disabled]="!isUserLoggedIn"
                            (click)="loadBookingPage(package.destinationId)">
                            {{ isUserLoggedIn ? 'Book Now' : 'Login to Book' }}
                        </button>
                        <div class="login-prompt" *ngIf="!isUserLoggedIn">
                            Please <a [routerLink]="['/login']">login</a> to book
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <p-dialog header="Itinerary" *ngIf="showItenary" [(visible)]="showItenary" [modal]="true" [responsive]="true"
        [maximizable]="true" [baseZIndex]="10000" styleClass="itinerary-dialog" width="800">

        <div class="itinerary-content">
            <div class="itinerary-header">
                <h2>{{selectedDestination.destinationName}}</h2>
                <div class="price-tag">From {{selectedDestination.chargePerPerson | currency}}</div>
            </div>

            <div class="itinerary-section">
                <div class="section-header">
                    <h3>Tour Highlights</h3>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="highlight-list">
                            <li *ngFor="let highlight of highlights">
                                {{highlight}}
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <img src="../../assets/prague.jpg" class="itinerary-image" alt="Tour highlight">
                    </div>
                </div>
            </div>

            <div class="itinerary-section">
                <div class="section-header">
                    <h3>Package Inclusions</h3>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <img src="../../assets/europe.jpg" class="itinerary-image" alt="Package inclusion">
                    </div>
                    <div class="col-md-6">
                        <ul class="inclusion-list">
                            <li *ngFor="let inclusion of inclusions">
                                {{inclusion}}
                            </li>
                        </ul>
                    </div>
                </div>
            </div>


            <div class="itinerary-section">
                <div class="section-header">
                    <h3>Tour Pace</h3>
                </div>
                <ul class="pace-list">
                    <li *ngFor="let pace of this.pace">
                        {{pace}}
                    </li>
                </ul>
            </div>
        </div>

        <p-footer>
            <div class="footer-buttons">
                <button type="button" class="btn-book" [disabled]="!isUserLoggedIn"
                    (click)="loadBookingPage(selectedDestination.destinationId)">
                    {{ isUserLoggedIn ? 'Book Now' : 'Login to Book' }}
                </button>
                <button type="button" class="btn-cancel" (click)="dropItenerary()">Close</button>
            </div>
            <div class="login-prompt" *ngIf="!isUserLoggedIn">
                Please <a [routerLink]="['/login']">login</a> to book
            </div>
        </p-footer>
    </p-dialog>
</div>